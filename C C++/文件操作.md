---
title: æ–‡ä»¶æ“ä½œ
aliases: 
author: SprInec
date: 2024-12-12
update: 2024-12-12 18:47:19
reference:
  - é»‘é©¬ç¨‹åºå‘˜C++æ•™ç¨‹
tags: cpp
---
# æ–‡ä»¶æ“ä½œ

ç¨‹åºè¿è¡Œæ—¶äº§ç”Ÿçš„æ•°æ®å±äºä¸´æ—¶æ•°æ®ï¼Œç¨‹åºä¸€æ—¦è¿è¡Œç»“æŸéƒ½ä¼šè¢«é‡Šæ”¾

é€šè¿‡**æ–‡ä»¶å¯ä»¥å°†æ•°æ®æŒä¹…åŒ–**

C++ ä¸­å¯¹æ–‡ä»¶æ“ä½œéƒ½éœ€è¦åŒ…å«å¤´æ–‡ä»¶ `<fstream>`

æ–‡ä»¶ç±»å‹åˆ†ä¸ºä¸¤ç§ï¼š
1. **æ–‡æœ¬æ–‡ä»¶**ï¼šæ–‡ä»¶ä»¥æ–‡æœ¬çš„ ASCII ç å½¢å¼å­˜å‚¨åœ¨è®¡ç®—æœºä¸­
2. **äºŒè¿›åˆ¶æ–‡ä»¶**ï¼šæ–‡ä»¶ä»¥æ–‡æœ¬çš„äºŒè¿›åˆ¶å½¢å¼å­˜å‚¨åœ¨è®¡ç®—æœºä¸­ï¼Œç”¨æˆ·ä¸€èˆ¬ä¸èƒ½ç›´æ¥è¯»æ‡‚ä»–ä»¬

æ“ä½œæ–‡ä»¶çš„ä¸‰å¤§ç±»ï¼š
1. `ofstream` ï¼šå†™æ“ä½œ
2. `ifstream` : è¯»æ“ä½œ
3. `fstream` : è¯»å†™æ“ä½œ

## 1. æ–‡æœ¬æ–‡ä»¶
### 1.1 å†™æ–‡ä»¶

å†™æ–‡ä»¶æ­¥éª¤ï¼š
1. åŒ…å«å¤´æ–‡ä»¶
   `{cpp icon} #include <fstream>`
2. åˆ›å»ºæµå¯¹è±¡ 
   `{cpp icon}ofstream ofs;`
3. æ‰“å¼€æ–‡ä»¶ 
   `{cpp icon}ofs.open("file_path", open_type);`
4. å†™æ•°æ® 
   `{cpp icon}ofs<< "data";`
5. å…³é—­æ–‡ä»¶ 
   `{cpp icon}ofs.close();`

`open_type` æ–‡ä»¶æ‰“å¼€æ–¹å¼ï¼š

| æ‰“å¼€æ–¹å¼        | è§£é‡Š            |
| :---------- | :------------ |
| ios::in     | è¯»æ–¹å¼æ‰“å¼€æ–‡ä»¶       |
| ios::out    | å†™æ–¹å¼æ‰“å¼€æ–‡ä»¶       |
| ios::ate    | åˆå§‹ä½ç½®ï¼šæ–‡ä»¶å°¾      |
| ios::app    | è¿½åŠ æ–¹å¼å†™æ–‡ä»¶       |
| ios::trunc  | å¦‚æœæ–‡ä»¶å­˜åœ¨åˆ™å…ˆåˆ é™¤å†åˆ›å»º |
| ios::binary | ä»¥äºŒè¿›åˆ¶æ–¹å¼æ‰“å¼€      |

>[!Tip] 
> 
> æ–‡ä»¶æ‰“å¼€æ–¹å¼å¯ä»¥é…åˆä½¿ç”¨ï¼Œåˆ©ç”¨ `|` æ“ä½œç¬¦åˆ†å‰²
> >[!Example] 
> >ç”¨äºŒè¿›åˆ¶æ–¹å¼å†™æ–‡ä»¶ï¼š`ios::binary|ios::out`

```cpp hl:2,7,9,11-13,15
#include <iostream>
#include <fstream>
using namespace std;

void write_file()
{
	ofstream ofs;

	ofs.open("test.txt", ios::out);

	ofs << "name: tom" << endl;
	ofs << "sex: man" << endl;
	ofs << "age: 10" << endl;

	ofs.close();
}
```

>[!Summary] 
> 
> - æ–‡ä»¶æ“ä½œå¿…é¡»åŒ…å«å¤´æ–‡ä»¶ `<fstream>`
> - å†™æ–‡ä»¶å¯ç”¨ `ofstream` æˆ–è€… `fstream` ç±»
> - æ‰“å¼€æ–‡ä»¶çš„æ—¶å€™éœ€è¦æŒ‡å®šæ“ä½œæ–‡ä»¶çš„è·¯å¾„ï¼Œä»¥åŠæ‰“å¼€æ–¹å¼
> - åˆ©ç”¨ `<<` å¯ä»¥å‘æ–‡ä»¶ä¸­å†™æ•°æ®
> - æ“ä½œå®Œæ¯•ï¼Œè¦å…³é—­æ–‡ä»¶

### 1.2 è¯»æ–‡ä»¶

è¯»æ–‡ä»¶ä¸å†™æ–‡ä»¶æ­¥éª¤ç›¸ä¼¼ï¼Œä½†æ˜¯èµŒçƒæ–¹å¼ç›¸å¯¹æ¯”è¾ƒå¤š

è¯»æ–‡ä»¶æ­¥éª¤å¦‚ä¸‹ï¼š
1. åŒ…å«å¤´æ–‡ä»¶
   `{cpp icon}#include <fstream>`
2. åˆ›å»ºæµå¯¹è±¡
   `{cpp icon}ifstream ifs;`
3. æ‰“å¼€æ–‡ä»¶å¹¶åˆ¤æ–­æ–‡ä»¶æ˜¯å¦æ‰“å¼€æˆåŠŸ
   `{cpp icon}ifs.open("file_path", open_type);`
4. è¯»æ•°æ®ï¼šå››ç§æ–¹å¼è¯»å–
5. å…³é—­æ–‡ä»¶
   `{cpp icon}ifs.close();`

```cpp hl:2,8,10,12,19-23,26-30,33-37,40-44,46
#include <iostream>
#include <fstream>
#include <string>
using namespace std;

void read_file()
{
	ifstream ifs;

	ifs.open("test.txt", ios::in);

	if (!ifs.is_open())
	{
		cout << "error: open file false!" << endl;
		return;
	}

	/* è¯»å–æ–¹å¼ä¸€ */
	char buf1[1024] = {0};
	while (ifs >> buf1)
	{
		cout << buf1 << endl;
	}

	/* è¯»å–æ–¹å¼äºŒ */
	char buf2[1024] = {0};
	while (ifs.getline(buf2, sizeof(buf2)))
	{
		cout << buf2 << endl;
	}

	/* è¯»å–æ–¹å¼ä¸‰ */
	string buf3;
	while (getline(ifs, buf3))
	{
		cout << buf3 << endl;
	}

	/* è¯»å–æ–¹å¼å›› */
	char c;
	while ((c = ifs.get()) != EOF ) // EOF: End Of File
	{
		cout << c << endl;
	}

	ifs.close();
}
```

>[!Summary] 
> 
> - è¯»æ–‡ä»¶å¯ä»¥åˆ©ç”¨ `ifstream` æˆ–è€… `fstream` ç±»
> - åˆ©ç”¨ `is_open` å‡½æ•°å¯ä»¥åˆ¤æ–­æ–‡ä»¶æ˜¯å¦æ‰“å¼€æˆåŠŸ
> - `close` å…³é—­æ–‡ä»¶

## 2. äºŒè¿›åˆ¶æ–‡ä»¶

ä»¥äºŒè¿›åˆ¶çš„æ–¹å¼å¯¹æ–‡ä»¶è¿›è¡Œè¯»å†™æ“ä½œ

æ‰“å¼€æ–¹å¼è¦æŒ‡å®šä¸º `ios::binary`

### 2.1 å†™æ–‡ä»¶

äºŒè¿›åˆ¶æ–¹å¼å†™æ–‡ä»¶ä¸»è¦åˆ©ç”¨æµå¯¹è±¡è°ƒç”¨å‡½æ•°æˆå‘˜ `write`

å‡½æ•°åŸå‹ï¼š`{cpp icon}ostream& write(const char * buffer, int len);`

å‚æ•°è§£é‡Šï¼šå­—ç¬¦æŒ‡é’ˆ `buffer` æŒ‡å‘å†…å­˜ä¸­ä¸€æ®µå­˜å‚¨ç©ºé—´ï¼Œ`len` æ˜¯è¯»å†™çš„å­—èŠ‚æ•°

```cpp hl:1,14,16,19,21
#include <fstream>
#include <string>
using namespace std;

class Person
{
public:
	char m_name[64];
	int m_age;
};

void binary_write_file()
{
	ofstream ofs("person.txt", ios::out | ios::binary);
	/* ğŸ’¡ä¹Ÿå¯ç”¨ä¸‹é¢çš„æ–¹å¼æ‰“å¼€æ–‡ä»¶ */
	// ofs.open("person.txt", ios::out|ios::binary);

	Person p = {"Tom", 18};
	ofs.write((const cahr *)&p, sizeof(Person)); 

	ofs.close();
}
```

### 2.2 è¯»æ–‡ä»¶

äºŒè¿›åˆ¶æ–¹å¼è¯»æ–‡ä»¶ä¸»è¦åˆ©ç”¨æµå¯¹è±¡è°ƒç”¨æˆå‘˜å‡½æ•° `read`

å‡½æ•°åŸå‹ï¼š`{cpp icon}istream& read(char *buffer, int len);`

å‚æ•°è§£é‡Šï¼šå­—ç¬¦æŒ‡é’ˆ `buffer` æŒ‡å‘å†…å­˜ä¸­ä¸€æ®µå­˜å‚¨ç©ºé—´ï¼Œ`len` æ˜¯è¯»å†™çš„å­—èŠ‚æ•°

```cpp hl:14,16,18,24-25,29
#include <iostream>
#include <fstream>
using namespace std;

class Person
{
public:
	char m_name[64];
	int m_age;
};

void binary_read_file()
{
	ifstream ifs;

	ifs.open("person.txt", ios::in | ios::binary);

	if (!ifs.is_open())
	{
		cout << "error: open file false!" << endl;
		return;
	}

	Person p;
	ifs.read((char *)&p, sizeof(p));

	cout << p.m_name << '\n' << p.m_age << endl;

	ifs.close();
}
```
